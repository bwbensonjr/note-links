{% extends "base.html" %}

{% block title %}Links Browser - Dashboard{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_links }}</div>
        <div class="stat-label">Total Links</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.fetched }}</div>
        <div class="stat-label">Fetched</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.summarized }}</div>
        <div class="stat-label">Summarized</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.tagged }}</div>
        <div class="stat-label">Tagged</div>
    </div>
</div>

<section class="section">
    <h2>Top Tags</h2>
    <div class="tag-list">
        {% for name, category, count in top_tags %}
        <a href="{{ url_for('main.browse', tag=name) }}" class="tag tag-{{ category | replace('_', '-') }}">
            {{ name }} <span class="tag-count">{{ count }}</span>
        </a>
        {% endfor %}
    </div>
    <p><a href="{{ url_for('main.browse_tags') }}">View all tags &rarr;</a></p>
</section>

<section class="section">
    <h2>Recent Links</h2>
    {% for link in recent %}
    <div class="link-card">
        <div class="link-header">
            <a href="{{ link.url }}" target="_blank" class="link-title">
                {{ link.page_title or link.title or link.description or link.url }}
            </a>
            <span class="link-domain">{{ link.domain | domain_display }}</span>
        </div>
        {% if link.description %}
        <p class="link-description">{{ link.description | truncate_smart(200) }}</p>
        {% endif %}
        {% if link.summary %}
        <p class="link-summary">{{ link.summary | truncate_smart(200) }}</p>
        {% endif %}
        <div class="link-meta">
            <span class="link-date">{{ link.source_date }}</span>
            {% if link_tags.get(link.id) %}
            <span class="link-tags">
                {% for tag_name, tag_category, _ in link_tags[link.id][:5] %}
                <a href="{{ url_for('main.browse', tag=tag_name) }}" class="tag tag-{{ tag_category | replace('_', '-') }} tag-small">{{ tag_name }}</a>
                {% endfor %}
            </span>
            {% endif %}
            <a href="{{ url_for('main.link_detail', link_id=link.id) }}" class="link-detail-link">Details</a>
        </div>
    </div>
    {% else %}
    <p class="empty-state">No links yet. Run the extractor to populate the database.</p>
    {% endfor %}
</section>
{% endblock %}
