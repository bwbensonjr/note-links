{% extends "base.html" %}

{% block title %}{{ link.page_title or link.title or link.url }} - Links Browser{% endblock %}

{% block content %}
<div class="link-detail">
    <p class="breadcrumb">
        <a href="{{ url_for('main.browse') }}">Browse</a> &raquo; Link Details
    </p>

    <h1 class="link-detail-title">{{ link.page_title or link.title or link.description or "Untitled" }}</h1>

    <div class="link-detail-url">
        <a href="{{ link.url }}" target="_blank">{{ link.url }}</a>
    </div>

    <div class="link-detail-meta">
        <span class="meta-item">
            <strong>Domain:</strong>
            <a href="{{ url_for('main.browse', domain=link.domain) }}">{{ link.domain | domain_display }}</a>
        </span>
        <span class="meta-item">
            <strong>Date:</strong>
            <a href="{{ url_for('main.browse', date_from=link.source_date, date_to=link.source_date) }}">{{ link.source_date }}</a>
        </span>
        <span class="meta-item">
            <strong>Status:</strong> {{ link.fetch_status.value }}
        </span>
    </div>

    {% if tags %}
    <div class="link-detail-section">
        <h2>Tags</h2>
        <div class="tag-list">
            {% for name, category, confidence in tags %}
            <a href="{{ url_for('main.browse', tag=name) }}" class="tag tag-{{ category | replace('_', '-') }}">
                {{ name }}
                {% if confidence < 1.0 %}<span class="tag-confidence">{{ (confidence * 100) | int }}%</span>{% endif %}
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if link.description %}
    <div class="link-detail-section">
        <h2>Note</h2>
        <p>{{ link.description }}</p>
    </div>
    {% endif %}

    {% if link.summary %}
    <div class="link-detail-section">
        <h2>Summary</h2>
        <p class="summary-text">{{ link.summary }}</p>
        {% if link.summarizer_model %}
        <p class="summary-meta">Generated by {{ link.summarizer_model }}</p>
        {% endif %}
    </div>
    {% endif %}

    {% if link.page_content %}
    <div class="link-detail-section">
        <h2>Content Preview</h2>
        <details>
            <summary>Show extracted content ({{ link.page_content | length }} characters)</summary>
            <div class="content-preview">
                {{ link.page_content[:5000] }}
                {% if link.page_content | length > 5000 %}
                <p class="truncated">... (truncated)</p>
                {% endif %}
            </div>
        </details>
    </div>
    {% endif %}

    {% if link.fetch_error %}
    <div class="link-detail-section error-section">
        <h2>Fetch Error</h2>
        <p class="error-text">{{ link.fetch_error }}</p>
    </div>
    {% endif %}

    <div class="link-detail-section">
        <h2>Source</h2>
        <p>
            <strong>File:</strong> {{ link.source_file }}<br>
            {% if link.parent_url %}
            <strong>Parent:</strong> <a href="{{ link.parent_url }}" target="_blank">{{ link.parent_url }}</a>
            {% endif %}
        </p>
    </div>
</div>
{% endblock %}
